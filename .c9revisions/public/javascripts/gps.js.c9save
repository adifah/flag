{"ts":1341848614974,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var neighbours = []; // count depends on the country\r\nvar europeCountries = []; // 50 countries\r\nvar options = []; // 15 options\r\nvar wrong = 0;\r\nvar correct = 0;\r\nvar europeCountryCodes= [];\r\nvar currentCountryCode = null;\r\nvar currentCountryName = null;\r\n\r\n$( document ).delegate(\"#gpsQuestioning\", \"pageinit\", function() {\r\n    getEuropeCountries();\r\n    $('#level1').click(function() {\r\n        console.log('start gps (level 1)');\r\n        $('#levels').css('display', 'none');\r\n        submitStart({game: 'gpsQuestioning', level: 'level1'});\r\n        geolocation();\r\n    });\r\n    $('#level2').click(function() {\r\n        console.log('start gps (level 2)');\r\n        $('#levels').css('display', 'none');\r\n        submitStart({game: 'gpsQuestioning', level: 'level2'});\r\n        geolocation();\r\n    });\r\n    $('#level3').click(function() {\r\n        console.log('start gps (level 3)');\r\n        $('#levels').css('display', 'none');\r\n        submitStart({game: 'gpsQuestioning', level: 'level3'});\r\n        geolocation();\r\n    });\r\n});\r\n\r\nfunction getEuropeCountries() {\r\n    europeCountries = [];\r\n    var europeCountriesUrl = \"http://api.geonames.org/childrenJSON?geonameId=6255148&username=adifah\"\r\n    $.getJSON(europeCountriesUrl, function(data) {\r\n        $.each(data.geonames, function(key, value) {\r\n            europeCountries.push(value.name);\r\n            europeCountryCodes.push(value.countryCode);\r\n        });\r\n    });\r\n}\r\n\r\nfunction geolocation() {\r\n    correct= 0;\r\n    wrong = 0;\r\n    options = [];\r\n    neighbours = [];\r\n    navigator.geolocation.getCurrentPosition(geolocation_action, errors_action);\r\n}\r\n\r\nfunction errors_action(error) {\r\n    switch(error.code){\r\n        case error.PERMISSION_DENIED: alert(\"permission denied by user\");break;\r\n        case error.POSITION_UNAVAILABLE: alert(\"geodata unavailable\");break;\r\n        default: alert (\"unknown Error\");break;\r\n    }\r\n}\r\n\r\nfunction geolocation_action(position){\r\n    var browserbreite = 200;\r\n    var karte_url = \"http://maps.google.com/maps/api/staticmap?sensor=true&center=\"+ position.coords.latitude +\",\"+ position.coords.longitude +\"zoom=15&size=\"+ browserbreite +\"x250&markers=color:red|label:A|\"+ position.coords.latitude +\",\"+ position.coords.longitude;\r\n    \r\n    determineNeighbours(position);\r\n    /*\r\n    jQuery(\"#karte\").html(\"\");\r\n    jQuery(\"#karte\")\r\n        .append(jQuery(document.createElement(\"img\")).attr(\"src\", karte_url).attr('id','karteAktuell'))\r\n        .append(jQuery('<p>').html(\"longitude: \" + position.coords.longitude))\r\n        .append(jQuery('<p>').html(\"latitude: \" + position.coords.latitude));\r\n        */\r\n}\r\n\r\nfunction determineNeighbours(position) {\r\n    var countryCodeUrl = \"http://api.geonames.org/countryCodeJSON?lat=\" + position.coords.latitude + \"&lng=\" + position.coords.longitude + \"&username=adifah\";\r\n    $.getJSON(countryCodeUrl, function(data) {\r\n        if(!currentCountryCode) {\r\n            currentCountryCode = data.countryCode;\r\n        } else {\r\n            currentCountryCode = europeCountryCodes[parseInt( Math.random()*50 )];\r\n        }\r\n        var countryInfoUrl = \"http://api.geonames.org/countryInfoJSON?country=\" + currentCountryCode + \"&username=adifah\";\r\n        $.getJSON(countryInfoUrl, function(data2) {\r\n            currentCountryName = data2.geonames[0].countryName;\r\n            var currentCountryGeonameId = data2.geonames[0].geonameId;\r\n            var neighboursUrl = \"http://api.geonames.org/neighboursJSON?formatted=true&geonameId=\" + currentCountryGeonameId + \"&username=adifah\";\r\n            jQuery(\"#neighbours\").html(\"<h3>Your country:</b> \" + currentCountryName + \" (population: \" + data2.geonames[0].population + \")</h3><h1>What are the neighbouring countries of \" + currentCountryName + \"?</h1>\");\r\n            $.getJSON(neighboursUrl, function(data3) {\r\n                printOptions(data3);\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nfunction printOptions(data) {\r\n    var geonames = data.geonames;\r\n    for (var key in geonames) {\r\n      if (geonames.hasOwnProperty(key)) {\r\n        neighbours.push(geonames[key].countryName);\r\n      }\r\n    }\r\n    europeCountries.sort(randomSort);\r\n    for(var i=0;i<14;i++) {\r\n        if(i<neighbours.length) {\r\n            options[i] = neighbours[i];                \r\n        } else {\r\n            randomCountryName = europeCountries[parseInt( Math.random()*49 )];\r\n            var index = $.inArray(randomCountryName , options);\r\n            if(index == -1) {\r\n                options[i] = randomCountryName;\r\n            } else {\r\n                i--;\r\n            }\r\n        }\r\n    }\r\n    options.sort(randomSort);\r\n    $('#neighbours').append(\"<button data-inline='true' class='neighbour'>\" + options.join(\"</button><button data-inline='true' class='neighbour'>\") + \"</button>\").trigger( \"create\" );;\r\n    \r\n    $('.neighbour').click(function() {\r\n        var name = $(this).html();\r\n        var index = $.inArray(name, neighbours);\r\n        if( index > -1) {\r\n            $(this).css('background-color','green');\r\n            neighbours[index] = null;\r\n            if(++correct === neighbours.length) {\r\n                var points = 1400 - (50 * wrong);\r\n                points = points < 0 ? 0 : points;\r\n                submitScore({'gameName': 'gpsQuestioning', 'score': points});\r\n                alert(\"you've found all \" + correct + \" neighbours with \" + wrong + \" mistakes (\" + points + \" points)\");\r\n                $('#neighbours').html(\"\");\r\n                $('#levels').css('display', 'block');\r\n            }\r\n        } else {\r\n            $(this).css('background-color','red');\r\n            wrong++;\r\n        }\r\n        $(this).unbind('click');\r\n    });\r\n}\r\n\r\n/* http://freewebdesigntutorials.com/javaScriptTutorials/jsArrayObject/randomizeArrayElements.htm */\r\nfunction randomSort(a,b) {\r\n    // Get a random number between 0 and 10\r\n    var temp = parseInt( Math.random()*10 );\r\n    // Get 1 or 0, whether temp is odd or even\r\n    var isOddOrEven = temp%2;\r\n    // Get +1 or -1, whether temp greater or smaller than 5\r\n    var isPosOrNeg = temp>5 ? 1 : -1;\r\n    // Return -1, 0, or +1\r\n    return( isOddOrEven*isPosOrNeg );\r\n}"]],"start1":0,"start2":0,"length1":0,"length2":6151}]],"length":6151}
