{"ts":1341848987030,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var resultMap,\r\n    lastTile = null,\r\n    moves = 0,\r\n    pairs = 0,\r\n    mistakes = 0,\r\n    board = '#board',\r\n    isPending = false;\r\n\r\n$( document ).delegate(\"#memorize\", \"pageinit\", function() {\r\n    $('#level1').click(function() {\r\n        console.log('start memorize (level 1)');\r\n        $('#levels').css('display', 'none');\r\n        submitStart({game: 'memorize', level: 'level1'});\r\n    });\r\n    $('#level2').click(function() {\r\n        console.log('start memorize (level 2)');\r\n        $('#levels').css('display', 'none');\r\n        submitStart({game: 'memorize', level: 'level2'});\r\n    });\r\n    $('#level3').click(function() {\r\n        console.log('start memorize (level 3)');\r\n        $('#levels').css('display', 'none');\r\n        submitStart({game: 'memorize', level: 'level3'});\r\n    });\r\n});\r\n\r\nfunction start(data) {\r\n    pairs = 0;\r\n    moves = 0;\r\n    mistakes = 0;\r\n    lastTile = null;\r\n    $(board).html(\"\");\r\n    resultMap = createMemoryBoard(data, board);\r\n    isPending = false;\r\n}\r\n\r\nfunction createMemoryBoard(data, board) {\r\n    var x,\r\n        map = [],\r\n        tiles = createTiles(data.deck),\r\n        clear = $(\"<div>\").css(\"clear\", \"both\");\r\n    for (x = 0; x < tiles.length; x++) {\r\n        map[x] = tiles[x];\r\n        $(board).append(tiles[x].html.attr('id', x));\r\n    }\r\n    $(board).append(clear);\r\n    return map;\r\n}\r\n\r\nfunction createTiles(countries) {\r\n    var x,\r\n        tiles = [];\r\n    for (x = 0; x < countries.length; x++) {\r\n        tiles[x] = createTile(countries[x]);\r\n    }\r\n    return tiles;\r\n}\r\n\r\nfunction createTile(country) {\r\n    var backValue;\r\n    var frontValue = '<img src=\"/images/flags/Euro.png\" />';\r\n    if(country.type === 'flag') {\r\n        backValue = '<img src=\"' + country.value + '\" />';\r\n    } else {\r\n        backValue = country.value;\r\n    }\r\n    var backSideHtml = $('<div>').addClass('back').addClass('side').html(backValue),\r\n        frontSideHtml = $('<div>').addClass('front').addClass('side').html(frontValue);\r\n    country.html = $('<div>').addClass('tile').click(tileClick).append(frontSideHtml).append(backSideHtml);\r\n    return country;\r\n}\r\n\r\nfunction tileClick() {\r\n    thisTile = $(this);\r\n    if (!thisTile.hasClass(\"flipped\") && !isPending) {\r\n        thisTile.addClass(\"flipped\");\r\n        if (lastTile === null) {\r\n            lastTile = thisTile;\r\n        } else {\r\n            moves++;\r\n            checkMove(thisTile);\r\n        }\r\n    }\r\n}\r\n\r\nfunction checkMove(currentTile) {\r\n    if (getTileId(lastTile) === getTileId(currentTile)) {\r\n        success(currentTile);\r\n    } else {\r\n        fail(currentTile);\r\n    }\r\n    if (pairs === resultMap.length/2) {\r\n        finish();\r\n    }\r\n}\r\n\r\nfunction success(currentTile) {\r\n    pairs++;\r\n    isPending = true;\r\n    setTimeout(function () {\r\n        currentTile.addClass(\"match\");\r\n        lastTile.addClass(\"match\");\r\n        lastTile = null;\r\n        isPending = false;\r\n    }, 350);\r\n}\r\n\r\nfunction fail(currentTile) {\r\n    if(isTileKnown(currentTile)) {\r\n        mistakes++;\r\n    }\r\n    if(isTileKnown(lastTile)) {\r\n        mistakes++;\r\n    }\r\n    maskTile(lastTile);\r\n    maskTile(currentTile);\r\n    lastTile = null;\r\n}\r\n\r\nfunction maskTile(tile) {\r\n    isPending = true;\r\n    setTimeout(function () {\r\n        isPending = false;\r\n        tile.removeClass(\"flipped\");\r\n    }, 1000);\r\n}\r\n\r\nfunction finish() {\r\n    setTimeout(function () {\r\n        var points = ((resultMap.length/2) * 50) - (mistakes * 50);\r\n        points = points < 0 ? 0 : points;\r\n        alert(\"you've finished the game in \" + moves + \" moves with \" + mistakes + \" mistakes (\" + points + \" points)\");\r\n        submitScore({'gameName': 'memorize', 'score': points});\r\n        restart();\r\n    }, 1000);\r\n}\r\n\r\nfunction restart() {\r\n    isPending = true;\r\n    $(board).children().each(function () {\r\n        $(this).removeClass(\"flipped\");\r\n    });\r\n    setTimeout(function () {\r\n        $('#board').html(\"\");\r\n        $('#levels').css('display', 'block');\r\n    }, 1000);\r\n}\r\n\r\nfunction getTileValue(tile) {\r\n    return resultMap[tile.attr('id')].value;\r\n}\r\n\r\nfunction getTileType(tile) {\r\n    return resultMap[tile.attr('id')].type;\r\n}\r\n\r\nfunction getTileId(tile) {\r\n    return resultMap[tile.attr('id')].id;\r\n}\r\n\r\nfunction isTileKnown(tile) {\r\n    var card = resultMap[tile.attr('id')];\r\n    if(card.known == null) {\r\n        card.known = true;\r\n        return false;\r\n    } else {\r\n        return true;   \r\n    }\r\n}"]],"start1":0,"start2":0,"length1":0,"length2":4427}]],"length":4427}
